<div id="content_detail" class="ui-corner-all">
<h1 class="title"><%= t('page.listing', :model => t('activerecord.models.purchase_request')) -%></h1>
<div id="content_list">
<h2 class="resource_title"><%= link_to h(@order_list.title), @order_list -%></h2>
<p>
  <% if @order_list.ordered_at -%>
    <%= t('activerecord.attributes.order_list.ordered_at') -%>: <%= l(@order_list.ordered_at) if @order_list.ordered_at -%>
    (<%= link_to h(@order_list.bookstore.name), @order_list.bookstore %>)
  <% end %>
  <%= t('order_list.total_price') -%>: <%= @order_list.total_price -%>
</p>

<%= form_for :purchase_requests, :url => order_list_purchase_requests_path(@order_list), :html => {:method => 'get'} do -%>
  <p>
    <%= t('page.search_term') -%>: <%= search_field_tag 'query', h(@query), {:id => 'search_form_top', :class => 'search_form'} -%>
    <%= submit_tag t('page.search') -%>
  </p>
  <%= javascript_tag("$('#search_form_top').focus()") -%>
<%- end -%>

<table class="index">
  <tr>
    <th><%= t('activerecord.attributes.purchase_request.title') -%></th>
    <th><%= t('activerecord.attributes.purchase_request.price') -%></th>
    <th id="edit_icons"></th>
  </tr>

  <%- @purchase_requests.each_with_index do |purchase_request, i| -%>
    <tr class="line<%= cycle("0", "1") -%>">
      <td>
        <%= link_to h(purchase_request.title), purchase_request -%>
        <br />
        <%= purchase_request.author -%>
        <%= purchase_request.publisher -%>
        <%=l purchase_request.date_of_publication if purchase_request.date_of_publication -%>
      </td>
      <td><%= purchase_request.price -%></td>
      <td>
        <%= link_to image_tag('icons/page_white_edit.png', :size => '16x16', :alt => t('page.edit')), edit_user_purchase_request_path(purchase_request.user.username, purchase_request) -%>
        <%- if can? :destroy, purchase_request -%>
          <%- if params[:mode] == "add" -%>
            <%= link_to t('page.add'), new_order_list_purchase_request_path(@order_list, :purchase_request_id => purchase_request.id, :mode => 'add') -%>
          <%- else -%>
            <%- order = @order_list.orders.find_by_purchase_request_id(purchase_request.id) -%>
            <%= link_to t('page.destroy'), order_list_order_path(@order_list, order), :confirm => t('page.are_you_sure'), :method => :delete -%>
          <%- end -%>
        <%- end -%>
      </td>
    </tr>
  <%- end -%>
</table>

<%= will_paginate(@purchase_requests) -%>

</div>
</div>

<div id="submenu" class="ui-corner-all">
  <ul>
    <%- unless @order_list.ordered? -%>
      <li><%= link_to t('activerecord.models.order'), edit_order_list_path(@order_list, :mode => 'order') -%></li>
    <%- end -%>
    <li><%= link_to t('purchase_request.all_request'), purchase_requests_path -%></li>
  </ul>
  <p>
    <%= link_to (image_tag 'feed-icon-14x14.png', :size => '14x14', :alt => t('page.feed'), :border => 0), :format => :rss -%>
    (<%= link_to 'RSS', purchase_requests_path(:format => :rss) -%>)
    (<%= link_to 'CSV', purchase_requests_path(:format => :csv, :locale => @locale) -%>)
  </p>
  <h4><%= t('page.bookmarklet') -%></h4>
  <ul>
    <li><a href="javascript:window.location.href='<%= new_user_purchase_request_url(current_user.username) -%>?purchase_request[url]='+encodeURIComponent(location.href)+'&purchase_request[title]='+encodeURIComponent(document.title);"><%= t('purchase_request.add_to_purchase_request') -%></a></li>
  </ul>
</div>
